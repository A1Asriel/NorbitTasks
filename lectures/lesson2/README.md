# Лекция 2. Знакомство с плаформой .NET. Фреймворк ASP.NET Core

В ходе этого занятия вы узнаете ответы на следующие вопросы:

1. Что такое ASP.NET приложения в современном мире?
2. Какая архитектура у приложения, построенного по принципу DDD?
3. Как приложение взаимодействует с внешним миром?
4. Как приложение взаимодействует с Базой Данных?
5. Как приложение тестировать с помощью внешних инструментов?


## Что такое ASP.NET приложения в современном мире

В современном мире (.NET 6 и выше), монополистом при построении 
веб приложений является ASP.NET Core. Данный фреймворк обладает
отличной расширяемостью, использует движок *Kestrel*, который
регулярно получает улучшения производительности.

Также стоит отметить и тот факт, что платформа .NET не стоит на месте
и регулярно улучшает как внутреннюю, так и внешнюю части. Так, например,
нововведением для .NET 6 стал Minimal API:

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/", () => "Hello world!");

app.Run();
```

И этот кусок кода является полноценным приложением!

В .NET 7 команда ASP.NET пошла дальше и решила улучшить работу с роутингом следующим образом: созданием групп.
И вместо следующего кода в .NET 6:
```csharp
app.MapGet("/api/users", () => { ... });
app.MapGet("/api/users/{id:long}", (long id) => { ... });
app.MapPost("/api/users", (User user) => { ... });
app.MapPut("/api/users/{id:long}", (long id, User user) => { ... });
app.MapDelete("/api/users/{id:long}", (long id) => { ... });
```
можно написать вот так:
```csharp
var userGroup = app.MapGroup("/api/users");

userGroup.MapGet("/", () => { ... });
userGroup.MapGet("/{id:long}", (long id) => { ... });
userGroup.MapPost("/", (User user) => { ... });
userGroup.MapPut("/{id:long}", (long id, User user) => { ... });
userGroup.MapDelete("/{id:long}", (long id) => { ... });
```
Код роутинга короче и позволяет понять к какой группе относятся роутинги.

## Какая архитектура у приложения, построенного по принципу DDD?

В современных приложениях, построенных по принципам DDD применяется следующая архитектура:

```mermaid
graph
    Domain --> Infrastructure;
    Infrastructure --> API;
```

Рассмотрим детально каждый слой и что он должен содержать:

*Domain* - данный слой содержит в себе доменные сущности, с которыми оперирует сервис, а также контракты взаимодействия (интерфейсы).

*Infrastructure* - данный слой содержит в себе бизнес-логику приложения: то, как приложение оперирует сущностями, которые являются доменными.

*API* - данный слой содержит в себе взаимодействие с внешним миром: общение через HTTP, обработчики внешнего трафика итд.

## Как приложение взаимодействует с внешним миром?

## Как приложение взаимодействует с Базой Данных?

## Как приложение тестировать с помощью внешних инструментов?

Один из инструментов для тестирования приложений, написанных на ASP.NET Core - это Swagger.
Данный инструмент помогает получить консоль разработчика, который может самостоятельно выполнить 
необходимые запросы к API с помощью UI.

Чтобы подключить Swagger в свой проект, необходимо выполнить следующие шаги:

1. Перейти в файл с расширением *.csproj в своем проекте ASP.NET Core
2. Найти элемент `<ItemGroup>...</ItemGroup>`, который содержит в себе ссылки на пакеты: `<PackageReference ... />`
3. Добавить следующие строки в данную группу, чтобы получилось вот так
    ```diff
    +<PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="7.0.5" />
    +<PackageReference Include="Swashbuckle.AspNetCore" Version="6.4.0" />
    ```
4. После сохранения вашего проекта, IDE обновит зависимости и вы сможете получить доступ к Swagger.
5. После этого, в файле `Program.cs` рекомендуется добавить следующие строки
    ```diff
    var builder = WebApplication.CreateBuilder(args);
   
    +builder.Services.AddEndpointsApiExplorer();
    +builder.Services.AddSwaggerGen();
   
    var app = builder.Build();
   
    +if (app.Environment.IsDevelopment())
    +{    
    +    app.UseSwagger();
    +    app.UseSwaggerUI();
    +}
   
    app.Run();
    ```